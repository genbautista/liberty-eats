<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/svg+xml" href="https://www.citypng.com/public/uploads/preview/cartoon-white-black-sheep-701751694953014c9syix3tze.png" />
<link rel="Stylesheet" href="style.css"/>
<title>LibertiesShops Map</title>
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <nav>
        <a href="./placeholder.html">
             <div class="navbar-item" style="width: 3.868rem; height: 2.067rem; right: 3.125rem; position: absolute; top: 0.9rem; display: flex; align-items: center; justify-content: center; color: black; font-size: 1.25rem; font-family: Inter; font-style: italic; font-weight: 800; text-shadow: 0rem 0.25rem 0.25rem rgba(0, 0, 0, 0.25)">Login</div>
        </a>
        <a href="./placeholder.html">
            <div class="navbar-item" style="width: 5.307rem; height: 1.567rem; right: 8.125rem; position: absolute; top: 1.15rem; display: flex; align-items: center; justify-content: center; color: black; font-size: 1.25rem; font-family: Inter; font-style: italic; font-weight: 800; text-shadow: 0rem 0.25rem 0.25rem rgba(0, 0, 0, 0.25)">Settings</div>
        </a>
        <a href="./map.html">
            <img class="navbar-item" style="width: 3rem; height: 3rem; right: 13.5rem; position: absolute; top: 0.5rem;" src="./src/assets/Map_icon.png" />
        </a>
        <a href="./index.html">
            <div class="navbar-item" style="width: 25.454rem; height: 2.769rem; left: 3.125rem; position: absolute; top: 0.6rem; display: flex; align-items: center; color: black; font-size: 3.125rem; font-family: Inter; font-style: italic; font-weight: 800; text-shadow: 0rem 0.25rem 0.25rem rgba(0, 0, 0, 0.25)">Liberties Shops</div>
        </a>
    </nav>

    <!-- Dropdown toggle button for advanced filters -->
    <button id="toggle-filters-btn" class="toggle-filters-btn">
        <span>‚öôÔ∏è Filters</span>
    </button>

    <!-- Map Container -->
    <div id="map"></div>

    <div class="filters-sidebar">
        <div class="filters-header">
            <h2 class="filters-title">Filters & Results</h2>
            <button class="filters-edit-btn">‚ãØ</button>
        </div>

        <div class="search-container">
            <input 
                type="text" 
                class="search-input" 
                id="main-search-input"
                placeholder="üîç Search shops or items..."
                autocomplete="off"
            >
            <div class="search-results-dropdown" id="search-results-dropdown"></div>
        </div>

         <section class="filter-section">
            <h3 class="section-header">Categories</h3>
            
            <button class="filter-item category-filter" data-category="Produce">
                <span class="filter-icon">üçé</span>
                <span class="filter-label">Produce</span>
            </button>

            <button class="filter-item category-filter" data-category="Dairy">
                <span class="filter-icon">ü•õ</span>
                <span class="filter-label">Dairy</span>
            </button>

            <button class="filter-item category-filter" data-category="Meat">
                <span class="filter-icon">ü•©</span>
                <span class="filter-label">Meat</span>
            </button>

            <button class="filter-item category-filter">
                <span class="filter-icon">üëï</span>
                <span class="filter-label">Clothing</span>
            </button>
        </section>

        <section class="filter-section">
            <h3 class="section-header">Store Types</h3>
            
            <button class="filter-item type-filter" data-type="Grocery">
                <span class="filter-icon">üõí</span>
                <span class="filter-label">Grocery</span>
            </button>

            <button class="filter-item type-filter" data-type="Restaurant">
                <span class="filter-icon">üçΩÔ∏è</span>
                <span class="filter-label">Restaurant</span>
            </button>

            <button class="filter-item type-filter" data-type="Pub">
                <span class="filter-icon">üç∫</span>
                <span class="filter-label">Pub</span>
            </button>

            <button class="filter-item type-filter" data-type="Hardware">
                <span class="filter-icon">üî®</span>
                <span class="filter-label">Hardware</span>
            </button>

            <button class="filter-item type-filter" data-type="Home Goods">
                <span class="filter-icon">üè†</span>
                <span class="filter-label">Home Goods</span>
            </button>

        </section>
        
        <section class="filter-section">
            <h3 class="section-header">Distance</h3>
            
            <button class="filter-item distance-filter active" data-distance="all">
                <span class="filter-icon">üìç</span>
                <span class="filter-label">All</span>
            </button>

            <button class="filter-item distance-filter" data-distance="1">
                <span class="filter-icon">üìç</span>
                <span class="filter-label">1km</span>
            </button>

            <button class="filter-item distance-filter" data-distance="2">
                <span class="filter-icon">üìç</span>
                <span class="filter-label">2km</span>
            </button>

            <button class="filter-item distance-filter" data-distance="5">
                <span class="filter-icon">üìç</span>
                <span class="filter-label">5km</span>
            </button>
        </section>

        <!-- Results section with shop cards -->
        <div class="results-section" id="results-section">
            <h3 class="results-header" id="results-header">Results (3)</h3>
            
            <div class="shop-card" data-shop-id="1" data-shop-name="Meath St. Butchers">
                <img class="shop-image" src="https://placehold.co/401x247" alt="Shop image">
                <div class="shop-content">
                    <div class="shop-info">
                        <h3 class="shop-name">Meath St. Butchers</h3>
                        <p class="shop-price">‚Ç¨2.65</p>
                    </div>
                    <div class="shop-info">
                        <p><b>1.2 KM away</b></p>
                        <p><b>12:00 - 18:15</b></p>
                    </div>
                </div>
            </div>

            <div class="shop-card" data-shop-id="2" data-shop-name="Thomas Street Market">
                <img class="shop-image" src="https://placehold.co/401x247" alt="Shop image">
                <div class="shop-content">
                    <div class="shop-info">
                        <h3 class="shop-name">Thomas Street Market</h3>
                        <p class="shop-price">‚Ç¨3.50</p>
                    </div>
                    <div class="shop-info">
                        <p><b>0.8 KM away</b></p>
                        <p><b>09:00 - 17:00</b></p>
                    </div>
                </div>
            </div>

            <div class="shop-card" data-shop-id="3" data-shop-name="Francis Street Deli">
                <img class="shop-image" src="https://placehold.co/401x247" alt="Shop image">
                <div class="shop-content">
                    <div class="shop-info">
                        <h3 class="shop-name">Francis Street Deli</h3>
                        <p class="shop-price">‚Ç¨4.25</p>
                    </div>
                    <div class="shop-info">
                        <p><b>1.5 KM away</b></p>
                        <p><b>08:00 - 19:00</b></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <aside id="advanced-filters" class="advanced-filters">
        <button class="close-filters-btn" id="close-filters-btn">√ó</button>
        
        <div class="keywords-section">
            <label class="filter-label-text">Keywords</label>
            <div class="keyword-tags">
                <span class="keyword-tag">
                    Organic
                    <button class="tag-remove">√ó</button>
                </span>
                <span class="keyword-tag">
                    Pork
                    <button class="tag-remove">√ó</button>
                </span>
                <span class="keyword-tag">
                    Budget
                    <button class="tag-remove">√ó</button>
                </span>
            </div>
        </div>

        <div class="checkbox-section">
            <label class="checkbox-item">
                <input type="checkbox" checked>
                <div class="checkbox-content">
                    <span class="checkbox-label">Open</span>
                    <span class="checkbox-description">Only shows stores that are currently open</span>
                </div>
            </label>

            <label class="checkbox-item">
                <input type="checkbox" checked>
                <div class="checkbox-content">
                    <span class="checkbox-label">Transportation</span>
                    <span class="checkbox-description">Expands search to include shops further away</span>
                </div>
            </label>

            <label class="checkbox-item">
                <input type="checkbox" checked>
                <div class="checkbox-content">
                    <span class="checkbox-label">Don't close soon</span>
                    <span class="checkbox-description">Removes stores that close less than 30 min from now</span>
                </div>
            </label>
        </div>

        <div class="slider-section">
            <div class="slider-header">
                <label class="filter-label-text">Price Range</label>
                <span class="slider-value">‚Ç¨10-100</span>
            </div>
            <input type="range" class="price-slider" min="10" max="100" value="50">
        </div>

        <div class="checkbox-section">
            <label class="filter-label-text">inventory</label>
            
            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>Clothing</span>
            </label>

            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>Butcher</span>
            </label>

            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>Produce</span>
            </label>
        </div>

        <div class="checkbox-section">
            <label class="filter-label-text">Distance</label>
            
            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>Nearest</span>
            </label>

            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>3Km</span>
            </label>

            <label class="checkbox-item-simple">
                <input type="checkbox" checked>
                <span>5Km</span>
            </label>
        </div>
    </aside>

    <script>
         const shopData = [
            {
                id: 1,
                name: "Meath St. Butchers",
                address: "Meath Street, Dublin 8",
                category: "Butcher",
                type: "Meat",
                lat: 53.3415,
                lng: -6.2777,
                price: "‚Ç¨2.65",
                hours: "8:00 - 17:30",
                distance: 1.2,
                inventory: [
                    { name: "Pork Chops", category: "Meat", price: 12.50 },
                    { name: "Beef Steak", category: "Meat", price: 18.00 },
                    { name: "Chicken Breast", category: "Meat", price: 8.50 },
                    { name: "Lamb Shoulder", category: "Meat", price: 15.00 }
                ]
            },
            {
                id: 2,
                name: "Thomas Street Market",
                address: "Thomas Street, Dublin 8",
                category: "Grocery",
                type: "Grocery",
                lat: 53.3425,
                lng: -6.2787,
                price: "‚Ç¨3.50",
                hours: "09:00 - 17:00",
                distance: 0.8,
                inventory: [
                    { name: "Tomatoes", category: "Produce", price: 2.50 },
                    { name: "Lettuce", category: "Produce", price: 1.80 },
                    { name: "Milk", category: "Dairy", price: 1.20 },
                    { name: "Bread", category: "Bakery", price: 2.00 },
                    { name: "Apples", category: "Produce", price: 3.00 }
                ]
            },
            {
                id: 3,
                name: "Francis Street Deli",
                address: "Francis Street, Dublin 8",
                category: "Deli",
                type: "Restaurant",
                lat: 53.3405,
                lng: -6.2767,
                price: "‚Ç¨4.25",
                hours: "08:00 - 19:00",
                distance: 1.5,
                inventory: [
                    { name: "Sandwiches", category: "Ready-made", price: 5.50 },
                    { name: "Coffee", category: "Beverages", price: 3.00 },
                    { name: "Pastries", category: "Bakery", price: 3.50 },
                    { name: "Salads", category: "Ready-made", price: 6.00 }
                ]
            }
        ];
        
        let map;
        let markers = {};
        let searchTimeout;

        window.addEventListener('load', function() {
            map = L.map('map').setView([53.3415, -6.2777], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            var blueIcon = L.icon({
                iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMTIgMEMxOC42MjcgMCAyNCA1LjM3MyAyNCAxMkMyNCAxOC42MjcgMTIgMzIgMTIgMzJDMTIgMzIgMCAyMC42MjcgMCAxMkMwIDUuMzczIDUuMzczIDAgMTIgMFoiIGZpbGw9IiMxREFFRUYiLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI2IiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=',
                iconSize: [24, 32],
                iconAnchor: [12, 32],
                popupAnchor: [0, -32]
            });

           shopData.forEach(shop => {
                const marker = L.marker([shop.lat, shop.lng], {icon: blueIcon})
                    .addTo(map)
                    .bindPopup(`<b>${shop.name}</b><br>${shop.price}<br>${shop.hours}`);
                
                // Store marker reference for later use
                markers[shop.id] = marker;
            });

            const toggleBtn = document.getElementById('toggle-filters-btn');
            const closeBtn = document.getElementById('close-filters-btn');
            const advancedFilters = document.getElementById('advanced-filters');

            toggleBtn.addEventListener('click', function() {
                advancedFilters.classList.add('active');
            });

            closeBtn.addEventListener('click', function() {
                advancedFilters.classList.remove('active');
            });
            
            initializeSearch();

            document.querySelectorAll('.shop-card').forEach(card => {
                card.addEventListener('click', function() {
                    const shopId = parseInt(this.dataset.shopId);
                    focusOnShop(shopId);
                });
            });
        });

        function initializeSearch() {
            const searchInput = document.getElementById('main-search-input');
            const searchDropdown = document.getElementById('search-results-dropdown');

            // Handle search input
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length === 0) {
                    searchDropdown.classList.remove('active');
                    resetMapView();
                    showAllShopCards();
                    return;
                }

                if (query.length >= 2) {
                    searchTimeout = setTimeout(() => {
                        performSearch(query);
                    }, 300);
                }
            });

            // Handle clicking outside to close dropdown
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchDropdown.classList.remove('active');
                }
            });

            // Handle Enter key in search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = e.target.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });
        }

        function performSearch(query) {
            const searchTerm = query.toLowerCase();
            const results = [];

            // Search through shops
            shopData.forEach(shop => {
                let score = 0;
                const matches = [];

                // Check shop name
                if (shop.name.toLowerCase().includes(searchTerm)) {
                    score += 10;
                    matches.push({ type: 'Shop name', value: shop.name });
                }

                // Check shop category
                if (shop.category && shop.category.toLowerCase().includes(searchTerm)) {
                    score += 5;
                    matches.push({ type: 'Category', value: shop.category });
                }

                // Check shop type
                if (shop.type && shop.type.toLowerCase().includes(searchTerm)) {
                    score += 5;
                    matches.push({ type: 'Type', value: shop.type });
                }

                // Check inventory items
                if (shop.inventory) {
                    shop.inventory.forEach(item => {
                        if (item.name.toLowerCase().includes(searchTerm)) {
                            score += 8;
                            matches.push({ type: 'Item', value: item.name });
                        }
                        if (item.category && item.category.toLowerCase().includes(searchTerm)) {
                            score += 3;
                            if (!matches.find(m => m.type === 'Item category' && m.value === item.category)) {
                                matches.push({ type: 'Item category', value: item.category });
                            }
                        }
                    });
                }

                if (score > 0) {
                    results.push({ shop, score, matches });
                }
            });

            // Sort by relevance
            results.sort((a, b) => b.score - a.score);

            // If no exact matches, try fuzzy search
            if (results.length === 0) {
                const fuzzyResults = fuzzySearch(searchTerm);
                results.push(...fuzzyResults);
            }

            // Display results
            displaySearchResults(results);
            updateShopCards(results);
            highlightMarkersOnMap(results);
        }

        function fuzzySearch(searchTerm) {
            const results = [];
            
            // Define related terms for fuzzy matching
            const relatedTerms = {
                'vegetables': ['tomatoes', 'lettuce', 'carrots', 'produce'],
                'fruit': ['apples', 'bananas', 'oranges', 'produce'],
                'meat': ['beef', 'pork', 'chicken', 'lamb', 'butcher'],
                'grocery': ['food', 'produce', 'market', 'store']
            };

            // Check if search term is related to any category
            for (const [key, values] of Object.entries(relatedTerms)) {
                if (key.includes(searchTerm) || values.some(v => v.includes(searchTerm))) {
                    // Find shops that might have related items
                    shopData.forEach(shop => {
                        let score = 0;
                        const matches = [];

                        if (shop.category && values.some(v => shop.category.toLowerCase().includes(v))) {
                            score += 2;
                            matches.push({ type: 'Similar', value: shop.category });
                        }

                        if (shop.inventory) {
                            shop.inventory.forEach(item => {
                                if (values.some(v => item.name.toLowerCase().includes(v))) {
                                    score += 1;
                                    if (!matches.find(m => m.value === item.category)) {
                                        matches.push({ type: 'Has similar items', value: item.category });
                                    }
                                }
                            });
                        }

                        if (score > 0) {
                            results.push({ shop, score, matches, fuzzy: true });
                        }
                    });
                    break;
                }
            }

            return results;
        }

        function displaySearchResults(results) {
            const dropdown = document.getElementById('search-results-dropdown');
            
            if (results.length === 0) {
                dropdown.innerHTML = '<div class="no-results">No shops or items found</div>';
                dropdown.classList.add('active');
                return;
            }

            let html = '';
            results.slice(0, 5).forEach(result => {
                const matchText = result.matches
                    .slice(0, 2)
                    .map(m => `${m.type}: ${m.value}`)
                    .join(', ');

                html += `
                    <div class="search-result-item" onclick="selectShopFromSearch(${result.shop.id})">
                        <div class="search-result-name">${result.shop.name}</div>
                        <div class="search-result-details">${result.shop.address} ‚Ä¢ ${result.shop.distance}km away</div>
                        <div class="search-result-match">${result.fuzzy ? 'Similar: ' : 'Found: '}${matchText}</div>
                    </div>
                `;
            });

            dropdown.innerHTML = html;
            dropdown.classList.add('active');
        }

        function updateShopCards(results) {
            const resultsSection = document.getElementById('results-section');
            const resultsHeader = document.getElementById('results-header');
            
            // Update header count
            resultsHeader.textContent = `Results (${results.length})`;
            
            // Hide all cards first
            document.querySelectorAll('.shop-card').forEach(card => {
                card.style.display = 'none';
            });
            
            // Show matching cards
            results.forEach(result => {
                const card = document.querySelector(`[data-shop-id="${result.shop.id}"]`);
                if (card) {
                    card.style.display = 'flex';
                }
            });
        }

        function highlightMarkersOnMap(results) {
            // Reset all markers
            Object.values(markers).forEach(marker => {
                marker.getElement()?.classList.remove('highlighted');
            });
            
            // Highlight search results
            if (results.length > 0) {
                const bounds = [];
                results.forEach(result => {
                    const marker = markers[result.shop.id];
                    if (marker) {
                        marker.getElement()?.classList.add('highlighted');
                        bounds.push([result.shop.lat, result.shop.lng]);
                    }
                });
                
                // Fit map to show all results
                if (bounds.length > 0) {
                    map.fitBounds(bounds, { padding: [50, 50] });
                }
            }
        }

        function selectShopFromSearch(shopId) {
            const shop = shopData.find(s => s.id === shopId);
            if (!shop) return;
            
            // Close dropdown
            document.getElementById('search-results-dropdown').classList.remove('active');
            
            // Update search input
            document.getElementById('main-search-input').value = shop.name;
            
            // Focus on shop
            focusOnShop(shopId);
        }

        function focusOnShop(shopId) {
            const shop = shopData.find(s => s.id === shopId);
            if (!shop) return;
            
            // Center map on shop
            map.setView([shop.lat, shop.lng], 17);
            
            // Open popup
            const marker = markers[shopId];
            if (marker) {
                marker.openPopup();
            }
            
            // Highlight shop card
            document.querySelectorAll('.shop-card').forEach(card => {
                if (parseInt(card.dataset.shopId) === shopId) {
                    card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    card.style.boxShadow = '0 0.5rem 1rem rgba(0, 136, 255, 0.3)';
                    setTimeout(() => {
                        card.style.boxShadow = '';
                    }, 2000);
                }
            });
        }

        function resetMapView() {
            map.setView([53.3415, -6.2777], 15);
            Object.values(markers).forEach(marker => {
                marker.getElement()?.classList.remove('highlighted');
            });
        }

        function showAllShopCards() {
            document.querySelectorAll('.shop-card').forEach(card => {
                card.style.display = 'flex';
            });
            document.getElementById('results-header').textContent = `Results (${shopData.length})`;
        }

        // When API is ready, replace the shopData array with this:
        /*
        async function loadShopsFromAPI() {
            try {
                const response = await fetch('YOUR_API_URL/shops');
                const shops = await response.json();
                
                // Load inventory for each shop
                for (let shop of shops) {
                    const invResponse = await fetch(`YOUR_API_URL/shops/${shop.id}/inventory`);
                    shop.inventory = await invResponse.json();
                }
                
                return shops;
            } catch (error) {
                console.error('Failed to load shops from API:', error);
                return shopData; // Fallback to local data
            }
        }
        */

    </script>
</body>
</html>